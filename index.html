<!DOCTYPE html>
<html data-bs-theme="dark">
    <head>
        <link href="vendor/css/bootstrap-5.3.0.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
        <link href="css/main.css" rel="stylesheet">

        <script type="importmap">
            {
                "imports": {
                    "vue": "https://unpkg.com/vue@3/dist/vue.esm-browser.js",
                    "octokit": "https://cdn.skypack.dev/@octokit/core@v4"
                }
            }
        </script>        
        <script src="vendor/js/bootstrap-5.3.0.min.js"></script>
    </head>

    <body>
        <div id="app">
            <nav class="navbar navbar-expand-lg">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#">
                        Manual Builder
                        <span>Make a Manual apworld for use with Archipelago!</span>
                    </a>
                </div>
              </nav>

            <div id="container">
                <div id="form_game" class="card form-card mb-3">
                    <form onsubmit="return false">
                        <div class="input-group">
                            <label for="game" class="form-label">Game:</label>
                            <input type="text" v-model="game" />
                        </div>
                        <div class="input-group">
                            <label for="creator" class="form-label">Creator:</label>
                            <input type="text" placeholder="your name, probably" v-model="creator" />
                        </div>
                        <div class="input-group">
                            <label for="filler" class="form-label">Filler Name:</label>
                            <input type="text" v-model="filler" />
                        </div>
                        <br /><br />

                        <div class="input-group">
                            <label for="starting_items" class="form-label">Starting Items: <b>*</b></label>
                            <em>Not supported in this builder yet. Add manually after.</em>
                        </div>
                        <br /><br />

                        <div class="input-group">
                            <input type="file" name="file" v-on:change="getImporter($event)" />
                            <div class="import-details" v-if="imported">
                                <div v-if="imported.status" v-html="imported.status"></div>
                            </div>
                        </div>
                        <div class="input-group">
                            <button class="btn btn-warning" v-on:click="imported && imported.fillAll()">Import from apworld</button>
                        </div><br /><br />
                        <div class="input-group">
                            <button class="btn btn-success" v-on:click="getExporter().toZip()">Export to apworld</button>
                        </div>
                        <div class="input-group">
                            <button class="btn btn-info" v-on:click="getYaml().toYaml()">Export YAML</button>
                        </div>
                    </form>
                </div>

                <div id="forms-tabbed">
                    <ul class="nav nav-tabs">
                        <li class="nav-item">
                            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#form_items">Items ({{items.length}})</button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#form_locations">Locations ({{locations.length}})</button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#form_regions">Regions ({{regions.length}})</button>
                        </li>
                    </ul>
                    <div class="tab-content">
                        <div id="form_items" class="tab-pane show active" role="tabpanel">
                            <template v-for="(item, index) in items" :key="item.id">
                                <div :class="item.classification + (!isItemValid(item) ? ' validation_error' : '')">
                                    <div class="remove-this">
                                        <button class="btn btn-secondary" v-on:click="removeItem(index)"><i class="bi bi-dash-lg"></i></button>        
                                    </div>

                                    <div class="form-group row">
                                        <div class="col">
                                            <label class="form-label">Name:</label>
                                            <input class="name" type="text" v-model="item.name" />
                                        </div>
                                    
                                        <div class="col">
                                            <label class="form-label">Categories:</label>
                                            <input type="text" v-model="item.categories" placeholder="Category 1, Category 2, etc." />
                                        </div>
                                    </div>
                                    <div class="form-group row">
                                        <div class="col">
                                            <label class="form-label">Classification: </label>
                                            <select v-model="item.classification">
                                                <option value="progression">Progression</option>
                                                <option value="progression_skip_balancing">Progression (Skip Balancing)</option>
                                                <option value="useful">Useful</option>
                                                <option value="filler">Filler</option>
                                                <option value="trap">Trap</option>
                                            </select>
                                        </div>
                                        <div class="col">
                                            <label class="form-label">Count:</label>
                                            <input class="count" type="text" v-model="item.count" />
                                        </div>
                                    </div>
                                    <hr />
                                    <div v-if="item.validation_error" class="validation_text">{{item.validation_error}}</div>
                                </div>
                            </template>

                            <div class="add-more">
                                <button class="btn btn-secondary" v-on:click="addItem()"><i class="bi bi-plus-lg"></i> Add Item</button>
                                <!-- <button class="btn btn-info" v-on:click=""><i class="bi bi-clipboard"></i> Copy all as JSON</button> -->
                            </div>
                        </div>
    
                        <div id="form_locations" class="tab-pane" role="tabpanel">
                            <template v-for="(location, index) in locations" :key="location.id">
                                <div :class="(location.victory ? 'victory' : '') + (!isLocationValid(location) ? ' validation_error' : '')">
                                    <div class="remove-this">
                                        <button class="btn btn-secondary" v-on:click="removeLocation(index)"><i class="bi bi-dash-lg"></i></button>        
                                    </div>

                                    <div class="form-group row">
                                        <div class="col">
                                            <label class="form-label">Name:</label>
                                            <input class="name" type="text" v-model="location.name" />
                                        </div>
                                    
                                        <div class="col">
                                            <label class="form-label">Categories:</label>
                                            <input type="text" v-model="location.categories" placeholder="Category 1, Category 2, etc." />
                                        </div>
                                    </div>
                                    
                                    <!-- <div class="form-group row">
                                        <div class="col">
                                            <label class="form-label">Placed Item:</label>
                                            <input class="name" type="text" v-model="location.place_item" />
                                        </div>
                                    
                                        <div class="col">
                                            <label class="form-label">Placed Item Category:</label>
                                            <input class="name" type="text" v-model="location.place_item_category" />
                                        </div>
                                    </div> -->

                                    <div class="form-group row" style="margin-left: 0">
                                        <div class="col">
                                            <label class="form-label">Region:</label>
                                            <select class="region" v-model="location.region">
                                                <template v-for="region_name in getRegionNames">
                                                    <option :value="region_name">{{region_name}}</option>
                                                </template>
                                            </select>
                                        </div>
                                        <div class="col">
                                            <label class="form-label">Requirements:</label>
                                            <textarea v-model="location.requirements" placeholder="e.g., |Master Sword| AND (|Lamp| OR |Fire Rod|) AND (|Crystal:7|)"></textarea>
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <div class="col">
                                            <label class="form-label">Place Item:</label>
                                            <select v-model="location.placement_type">
                                                <option value="none">None</option>
                                                <option value="single_item">By Name</option>
                                                <option value="category_item">By Category Name</option>
                                            </select> &nbsp;
                                            <input type="text" v-model="location.placement" class="name" placeholder="Match 1, Match 2, etc." />
                                        </div>
                                        <div class="col col-center">
                                            <input type="checkbox" v-model="location.victory" /> <label class="form-label">Victory?</label>
                                        </div>
                                    </div>
                                    <hr />
                                    <div v-if="location.validation_error" class="validation_text">{{location.validation_error}}</div>
                                </div>
                            </template>

                            <div class="add-more">
                                <button class="btn btn-secondary" v-on:click="addLocation()"><i class="bi bi-plus-lg"></i> Add Location</button>
                                <!-- <button class="btn btn-info" v-on:click=""><i class="bi bi-clipboard"></i> Copy all as JSON</button> -->
                            </div>
                        </div>
    
                        <div id="form_regions" class="tab-pane" role="tabpanel">
                            <template v-for="(region, index) in regions" :key="region.id">
                                <div :class="(region.starting ? 'starting' : '') + (!isRegionValid(region) ? ' validation_error' : '')">
                                    <div class="remove-this">
                                        <button class="btn btn-secondary" v-on:click="removeRegion(index)"><i class="bi bi-dash-lg"></i></button>        
                                    </div>

                                    <div class="form-group row">
                                        <div class="col">
                                            <label class="form-label">Name:</label>
                                            <input class="name" type="text" v-model="region.name" />
                                        </div>
                                    
                                        <div class="col">
                                            <label class="form-label">Connects To:</label>
                                            <input type="text" v-model="region.connects_to" placeholder="Region 1, Region 2, etc." />
                                        </div>
                                    </div>

                                    <div class="form-group row">
                                        <div class="col">
                                            <input type="checkbox" v-model="region.starting" /> <label class="form-label">Starting Region?</label>
                                        </div>

                                        <div class="col">
                                            <label class="form-label">Requirements:</label>
                                            <textarea v-model="region.requirements" placeholder="e.g., |Master Sword| AND (|Lamp| OR |Fire Rod|) AND (|Crystal:7|)"></textarea>
                                        </div>
                                    </div>
                                    <hr />
                                    <div v-if="region.validation_error" class="validation_text">{{region.validation_error}}</div>
                                </div>
                            </template>

                            <div class="add-more">
                                <button class="btn btn-secondary" v-on:click="addRegion()"><i class="bi bi-plus-lg"></i> Add Region</button>
                                <!-- <button class="btn btn-info" v-on:click=""><i class="bi bi-clipboard"></i> Copy all as JSON</button> -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>           
        </div>

        <script src="vendor/js/jszip.min.js"></script>
        <script src="vendor/js/filesaver-1.3.8.js"></script>

        <script type="module" src="js/app.js"></script>
    </body>
</html>